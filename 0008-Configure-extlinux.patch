From 5054123489440230e04e28be41ff661289fb0862 Mon Sep 17 00:00:00 2001
From: Lubomir Rintel <lkundrak@v3.sk>
Date: Mon, 9 Jun 2014 13:27:23 +0200
Subject: [PATCH 8/8] Configure extlinux

---
 imgcreate/creator.py | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/imgcreate/creator.py b/imgcreate/creator.py
index 9864122..24f2a38 100644
--- a/imgcreate/creator.py
+++ b/imgcreate/creator.py
@@ -1141,6 +1141,24 @@ class PartitionedImageCreator(ImageCreator):
 
         os.symlink('../boot/grub/grub.conf', self._instroot + '/etc/grub.conf')
 
+    def __create_bootconfig_extlinux(self, name, version, bootpar, ver, args):
+        cfg = "# extlinux.conf generated by python-imgcreate\n"
+        cfg += "#\n"
+        cfg += "default %s (%s) %s\n" % (name, ver, version)
+        cfg += "\n"
+        cfg += "label %s (%s) %s\n" % (name, ver, version)
+        cfg += "        kernel /vmlinuz-%s\n" % (ver)
+        cfg += "        append " + args + "\n"
+        cfg += "        fdtdir /dtb-%s/\n" % (ver)
+        cfg += "        initrd /initramfs-%s.img\n" % (ver)
+
+        os.mkdir(self._instroot + '/boot/extlinux')
+        cfgf = open(self._instroot + '/boot/extlinux/extlinux.conf', "w")
+        cfgf.write(cfg)
+        cfgf.close()
+
+        os.symlink('../boot/extlinux/extlinux.conf', self._instroot + '/etc/extlinux.conf')
+
     def __install_grub(self):
         (dmapfd, dmap) = self._mkstemp('device-map')
         os.write(dmapfd, '(hd0) ' + self._image)
@@ -1192,6 +1210,8 @@ class PartitionedImageCreator(ImageCreator):
             self.__bootloader = 'grub'
         if self.__bootloader == 'grub':
             self.__create_bootconfig_grub(name, version, bootpar, ver, args)
+        else:
+            self.__create_bootconfig_extlinux(name, version, bootpar, ver, args)
 
     def _stage_final_image(self):
         if self.__bootloader == 'grub':
-- 
1.9.3

